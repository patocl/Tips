# Function to query local users on the machine
function Get-LocalUsers {
    Get-WmiObject Win32_UserAccount | Where-Object { $_.LocalAccount -eq $true }
}

# Function to get group memberships for a local user
function Get-LocalUserGroupMemberships {
    param (
        [string]$userName
    )

    $localUser = New-Object System.Security.Principal.NTAccount($userName)
    $localUserSID = $localUser.Translate([System.Security.Principal.SecurityIdentifier]).Value
    $userGroups = Get-WmiObject Win32_GroupUser | Where-Object { $_.PartComponent -match $localUserSID }

    if ($userGroups) {
        $groupNames = $userGroups | ForEach-Object { $_.Caption }
        return $groupNames
    } else {
        return @()
    }
}

# Query local users
$localUsers = Get-LocalUsers
if ($localUsers) {
    Write-Output "Local Users:"
    foreach ($user in $localUsers) {
        Write-Output "User: $($user.Name)"
        Write-Output "Description: $($user.Description)"
        Write-Output "Account Type: Local User"

        $userGroups = Get-LocalUserGroupMemberships -userName $user.Name
        if ($userGroups) {
            Write-Output "Group Memberships:"
            foreach ($groupName in $userGroups) {
                Write-Output "- $groupName"
            }
        } else {
            Write-Output "User is not a member of any groups."
        }
        Write-Output "-------------------------"
    }
} else {
    Write-Output "No local users found."
}
